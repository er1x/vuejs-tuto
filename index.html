<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Star Wars Movies</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.6/superhero/bootstrap.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1 class="text-center">Pelis de Star Wars</h1>

  <div class="container">
    <div id="app">
      <div class="row">
        <div class="col-md-4" v-for="film in films">
          <film-card v-bind:title="film.title"
                     v-bind:id="film.id"
                     v-bind:opening="film.opening"
                     v-bind:seen="film.seen"
          >
          </film-card>
        </div>
      </div>
    </div>
  </div>

  <template id="filmCard">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title">{{* title }}</h3>
      </div>
      <div class="panel-body" :class="{'seen': seen}">
        {{* opening }}
      </div>
      <button class="btn btn-block"
              :class="{'btn-danger': seen, 'btn-success': !seen}"
              @click="toggleSeen"
      >
        {{ seenText }}
      </button>
    </div>
  </template>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.24/vue.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/0.7.2/vue-resource.min.js"></script>
  <script>

    Vue.component('film-card', {
      template: '#filmCard',
      props: ['title', 'opening', 'seen'],
      methods: {
        toggleSeen: function () {
          this.seen = !this.seen
        }
      },
      computed: {
        seenText: function () {
          return this.seen ? 'Ya la he visto' : 'Â¡Quiero verla!'
        }
      }
    })

    new Vue({
      el: '#app',
      data: {
        films: []
      },
      created: function () {
        this.$http.get('https://swapi.co/api/films/')
                  .then(function (response) {
                    this.films = response.data.results.map(function (film) {
                      return {
                        id: film.episode_id,
                        title: film.title,
                        opening: film.opening_crawl,
                        seen: false
                      }
                    })
                  }.bind(this))
      }
    })
  </script>
</body>
</html>
